# IVAgent - æ™ºèƒ½æ¼æ´åˆ†æç³»ç»Ÿ

[![Python 3.10+](https://img.shields.io/badge/python-3.10+-blue.svg)](https://www.python.org/downloads/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)

IVAgent (Intelligent Vulnerability Analysis Agent) æ˜¯ä¸€ä¸ªåŸºäºå¤§è¯­è¨€æ¨¡å‹çš„å¼‚æ­¥æ™ºèƒ½ç¨‹åºåˆ†ææ¡†æ¶ï¼Œä¸“æ³¨äºäºŒè¿›åˆ¶å’Œæºä»£ç çš„æ·±åº¦æ¼æ´æŒ–æ˜ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- **ğŸ” å¤šå¼•æ“æ”¯æŒ**ï¼šç»Ÿä¸€æ¥å£æ”¯æŒ IDA Pro (äºŒè¿›åˆ¶)ã€JEB (Android APK)ã€ABC Decompiler (HarmonyOS) å’Œæºä»£ç åˆ†æ
- **ğŸ¤– AI é©±åŠ¨**ï¼šåŸºäº LangGraph å’Œ Tool Call æœºåˆ¶çš„æ·±åº¦æ¼æ´æ£€æµ‹
- **âš¡ é«˜å¹¶å‘æ¶æ„**ï¼šå¼‚æ­¥åç¨‹è®¾è®¡ï¼Œæ”¯æŒå¤§è§„æ¨¡å‡½æ•°å¹¶è¡Œåˆ†æ
- **ğŸ“‹ å‰ç½®æ¡ä»¶é…ç½®**ï¼šä½¿ç”¨ Markdown å®šä¹‰åˆ†æçº¦æŸï¼Œé™ä½ LLM ä½¿ç”¨é—¨æ§›
- **ğŸŒ å¯è§†åŒ–æ—¥å¿—**ï¼šå†…ç½® Web ç•Œé¢å®æ—¶æŸ¥çœ‹ LLM äº¤äº’è¿‡ç¨‹
- **ğŸ”’ çº¦æŸä¼ æ’­**ï¼šæ”¯æŒå‡½æ•°è°ƒç”¨é“¾ä¸­çš„å‚æ•°çº¦æŸä¼ é€’

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.10+
- OpenAI API Key æˆ–å…¼å®¹çš„ LLM æœåŠ¡

### å®‰è£…

```bash
# å…‹éš†ä»“åº“
git clone <repository-url>
cd ivas

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### åŸºç¡€ä½¿ç”¨

#### 1. åˆ†æå•ä¸ªå‡½æ•°

```bash
python ivagent_scan.py \
    --engine ida \
    --target /path/to/binary.idb \
    --function "0x140001000" \
    --preset binary \
    --api-key $OPENAI_API_KEY \
    --model gpt-4
```

#### 2. æ‰¹é‡åˆ†æå¤šä¸ªå‡½æ•°

```bash
python ivagent_scan.py \
    --engine ida \
    --target /path/to/binary.idb \
    --function "0x140001000" "0x140001100" "0x140001200" \
    --preset binary \
    --concurrency 5 \
    --api-key $OPENAI_API_KEY
```

#### 3. ä½¿ç”¨è‡ªå®šä¹‰é…ç½®

```bash
python ivagent_scan.py \
    --engine jeb \
    --target /path/to/app.apk \
    --function "Lcom/example/MainActivity;->onCreate" \
    --config /path/to/custom_precondition.md \
    --api-key $OPENAI_API_KEY
```

### å¯åŠ¨æ—¥å¿—å¯è§†åŒ–æœåŠ¡

```bash
# ä½¿ç”¨å¿«é€Ÿå¯åŠ¨è„šæœ¬
python launch_logger.py

# æˆ–ä½¿ç”¨å‚æ•°
python launch_logger.py --port 8080 --host 0.0.0.0
```

è®¿é—® `http://localhost:8080` æŸ¥çœ‹ LLM äº¤äº’æ—¥å¿—ã€‚

### ç•Œé¢é¢„è§ˆ

**LLM äº¤äº’æ—¥å¿—æŸ¥çœ‹**

![LLM Log Viewer](docs/images/llm-log.png)

å®æ—¶è¿½è¸ªæ¯ä¸€æ¬¡ LLM è°ƒç”¨ï¼ŒåŒ…æ‹¬å®Œæ•´çš„ Promptã€Responseã€è€—æ—¶ç»Ÿè®¡ã€‚

**æ¼æ´åˆ†æç»“æœ**

![Vulnerability Dashboard](docs/images/vuln.png)

å¯è§†åŒ–å±•ç¤ºå‘ç°çš„æ¼æ´ï¼Œæ”¯æŒæŒ‰ä¸¥é‡ç¨‹åº¦ã€ç½®ä¿¡åº¦ç­›é€‰ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
ivas/
â”œâ”€â”€ ivagent/                    # æ ¸å¿ƒæ¡†æ¶ä»£ç 
â”‚   â”œâ”€â”€ agents/                 # Agent å±‚
â”‚   â”‚   â”œâ”€â”€ base.py            # Agent åŸºç±»
â”‚   â”‚   â”œâ”€â”€ deep_vuln_agent.py # æ·±åº¦æ¼æ´æŒ–æ˜ Agent
â”‚   â”‚   â”œâ”€â”€ callsite_agent.py  # è°ƒç”¨ç‚¹åˆ†æ Agent
â”‚   â”‚   â”œâ”€â”€ function_summary_agent.py  # å‡½æ•°æ‘˜è¦ Agent
â”‚   â”‚   â””â”€â”€ prompts.py         # æç¤ºè¯æ¨¡æ¿
â”‚   â”œâ”€â”€ engines/               # å¼•æ“å±‚
â”‚   â”‚   â”œâ”€â”€ base_static_analysis_engine.py  # å¼•æ“åŸºç±»
â”‚   â”‚   â”œâ”€â”€ ida_engine.py      # IDA Pro å¼•æ“
â”‚   â”‚   â”œâ”€â”€ jeb_engine.py      # JEB å¼•æ“
â”‚   â”‚   â”œâ”€â”€ abc_engine.py      # ABC Decompiler å¼•æ“
â”‚   â”‚   â”œâ”€â”€ source_code_engine.py  # æºç åˆ†æå¼•æ“
â”‚   â”‚   â””â”€â”€ factory.py         # å¼•æ“å·¥å‚
â”‚   â”œâ”€â”€ models/                # æ•°æ®æ¨¡å‹å±‚
â”‚   â”‚   â”œâ”€â”€ vulnerability.py   # æ¼æ´æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ constraints.py     # çº¦æŸ/å‰ç½®æ¡ä»¶æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ function.py        # å‡½æ•°æ¨¡å‹
â”‚   â”‚   â””â”€â”€ callsite.py        # è°ƒç”¨ç‚¹æ¨¡å‹
â”‚   â”œâ”€â”€ core/                  # æ ¸å¿ƒå·¥å…·å±‚
â”‚   â”‚   â”œâ”€â”€ tool_llm_client.py # Tool Call LLM å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ llm_logger.py      # LLM æ—¥å¿—ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ agent_logger.py    # Agent æ‰§è¡Œæ—¥å¿—
â”‚   â”‚   â””â”€â”€ vuln_storage.py    # æ¼æ´å­˜å‚¨ç®¡ç†
â”‚   â””â”€â”€ web/                   # Web å¯è§†åŒ–æœåŠ¡
â”‚       â”œâ”€â”€ api.py             # FastAPI æ¥å£
â”‚       â”œâ”€â”€ server.py          # æœåŠ¡å™¨å¯åŠ¨è„šæœ¬
â”‚       â””â”€â”€ static/            # å‰ç«¯èµ„æº
â”œâ”€â”€ preconditions/             # é¢„ç½®åˆ†æé…ç½®
â”‚   â”œâ”€â”€ android.md            # Android åˆ†æé…ç½®
â”‚   â”œâ”€â”€ harmony.md            # HarmonyOS åˆ†æé…ç½®
â”‚   â”œâ”€â”€ binary.md             # äºŒè¿›åˆ¶åˆ†æé…ç½®
â”‚   â””â”€â”€ _template.md          # é…ç½®æ¨¡æ¿
â”œâ”€â”€ ivagent_scan.py           # ä¸»æ‰«æè„šæœ¬
â”œâ”€â”€ launch_logger.py          # æ—¥å¿—æœåŠ¡å¯åŠ¨å™¨
â””â”€â”€ start_ida_rpc.py         # IDA RPC æœåŠ¡å¯åŠ¨å™¨
```

## ğŸ”§ æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         IVAgent æ¶æ„                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   CLI å±‚    â”‚  â”‚   Web å±‚    â”‚  â”‚   API å±‚    â”‚             â”‚
â”‚  â”‚ ivagent_scanâ”‚  â”‚  æ—¥å¿—å¯è§†åŒ– â”‚  â”‚  REST API   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                           â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Agent å±‚                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚DeepVulnAgent â”‚  â”‚CallsiteAgent â”‚  â”‚FunctionSummaryâ”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  Engine å±‚ (å¼‚æ­¥)                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ IDA     â”‚  â”‚ JEB     â”‚  â”‚ ABC     â”‚  â”‚ Source  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ Engine  â”‚  â”‚ Engine  â”‚  â”‚ Engine  â”‚  â”‚ Engine  â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶è¯´æ˜

| ç»„ä»¶ | èŒè´£ | å…³é”®æ–‡ä»¶ |
|------|------|----------|
| **Agent å±‚** | å®ç° AI é©±åŠ¨çš„åˆ†æé€»è¾‘ | `agents/deep_vuln_agent.py` |
| **Engine å±‚** | å°è£…åç¼–è¯‘/åˆ†æå·¥å…·æ¥å£ | `engines/` |
| **Model å±‚** | å®šä¹‰æ ¸å¿ƒæ•°æ®ç»“æ„ | `models/` |
| **Core å±‚** | æä¾›é€šç”¨å·¥å…·å’ŒæœåŠ¡ | `core/` |
| **Preconditions** | åˆ†æçº¦æŸé…ç½® | `preconditions/` |

## ğŸ“ å‰ç½®æ¡ä»¶é…ç½®

å‰ç½®æ¡ä»¶ä½¿ç”¨ Markdown æ ¼å¼å®šä¹‰ï¼Œå¸®åŠ© Agent ç†è§£ç›®æ ‡å‡½æ•°çš„ä¸Šä¸‹æ–‡ï¼š

```markdown
---
name: Binary Parser Function
description: äºŒè¿›åˆ¶è§£æå‡½æ•°çš„å®‰å…¨åˆ†æé…ç½®
target: binary_parser
version: "1.0"
author: security_team
taint_sources: ["param1", "param2"]
---

## å‚æ•°è¯´æ˜

### ç¬¬ä¸€ä¸ªå‚æ•°
- æŒ‡å‘æ”»å‡»è€…æ§åˆ¶çš„æ•°æ®ç¼“å†²åŒº

### ç¬¬äºŒä¸ªå‚æ•°  
- æ•°æ®é•¿åº¦ï¼ˆå¯èƒ½ç”±æ”»å‡»è€…æŒ‡å®šï¼‰

## å®‰å…¨æ£€æŸ¥æ¸…å•

- [ ] æ˜¯å¦éªŒè¯é•¿åº¦å‚æ•°çš„åˆç†æ€§ï¼Ÿ
- [ ] å†…å­˜æ‹·è´æ“ä½œæ˜¯å¦å®‰å…¨ï¼Ÿ
```

## ğŸ”Œ æ”¯æŒçš„å¼•æ“

| å¼•æ“ | ç›®æ ‡ç±»å‹ | é»˜è®¤ç«¯å£ | çŠ¶æ€ |
|------|----------|----------|------|
| IDA | äºŒè¿›åˆ¶ (PE/ELF/Mach-O) | 9999 | âœ… å·²æ”¯æŒ |
| JEB | Android APK/DEX | 16161 | âœ… å·²æ”¯æŒ |
| ABC | HarmonyOS åº”ç”¨ | 8651 | âœ… å·²æ”¯æŒ |
| Source | æºä»£ç  | - | âœ… å·²æ”¯æŒ |

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### åˆ›å»ºè‡ªå®šä¹‰ Agent

```python
from ivagent.agents.base import BaseAgent

class MyCustomAgent(BaseAgent):
    async def run(self, **kwargs) -> Dict[str, Any]:
        # å®ç°åˆ†æé€»è¾‘
        function_code = await self.engine.get_function_def(
            function_signature=kwargs['signature']
        )
        # ...
        return {"vulnerabilities": []}
```

### æ·»åŠ æ–°å¼•æ“

```python
from ivagent.engines.base_static_analysis_engine import BaseStaticAnalysisEngine

class MyEngine(BaseStaticAnalysisEngine):
    async def get_function_def(self, function_signature=None, **kwargs):
        # å®ç°è·å–å‡½æ•°å®šä¹‰
        pass
    
    async def get_callee(self, function_signature):
        # å®ç°è·å–è¢«è°ƒç”¨è€…
        pass
```

## ğŸ“Š æ¼æ´æ¨¡å‹

```python
@dataclass
class Vulnerability:
    type: VulnerabilityType      # æ¼æ´ç±»å‹
    name: str                    # æ¼æ´åç§°
    description: str             # è¯¦ç»†æè¿°
    location: str                # ä½ç½®ä¿¡æ¯
    severity: float             # ä¸¥é‡ç¨‹åº¦ (0-1)
    confidence: float           # ç½®ä¿¡åº¦ (0-1)
    data_flow: DataFlowPath     # æ•°æ®æµè·¯å¾„
    remediation: str            # ä¿®å¤å»ºè®®
```

æ”¯æŒçš„æ¼æ´ç±»å‹ï¼š
- ç¼“å†²åŒºæº¢å‡º (Buffer Overflow)
- æ•°ç»„è¶Šç•Œ (Array OOB)
- ä»»æ„åœ°å€è¯»å†™ (Arbitrary RW)
- æ ¼å¼åŒ–å­—ç¬¦ä¸² (Format String)
- æ•´æ•°æº¢å‡º (Integer Overflow)
- UAF (Use After Free)
- å‘½ä»¤æ³¨å…¥ (Command Injection)
- SQL æ³¨å…¥ (SQL Injection)

## ğŸ“ˆ æ—¥å¿—ä¸ç›‘æ§

ç³»ç»Ÿæä¾›å®Œæ•´çš„ LLM äº¤äº’æ—¥å¿—è®°å½•ï¼š

- **è¯·æ±‚/å“åº”è¿½è¸ª**ï¼šå®Œæ•´çš„ Prompt å’Œ LLM è¾“å‡º
- **Agent æ‰§è¡Œè¿½è¸ª**ï¼šAgent è°ƒç”¨é“¾å’Œæ‰§è¡Œæ—¶é—´
- **æ¼æ´ç®¡ç†**ï¼šæ¼æ´å‘ç°ã€éªŒè¯ã€ä¿®å¤çŠ¶æ€è¿½è¸ª
- **å®æ—¶ WebSocket**ï¼šæ—¥å¿—å®æ—¶æ¨é€åˆ°å‰ç«¯

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ PRï¼

1. Fork ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»º Pull Request


---

**å…è´£å£°æ˜**: æœ¬å·¥å…·ä»…ç”¨äºåˆæ³•çš„å®‰å…¨ç ”ç©¶å’Œæ¼æ´åˆ†æï¼Œä½¿ç”¨è€…éœ€éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ã€‚
